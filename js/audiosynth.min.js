var Synth,AudioSynth,AudioSynthInstrument;!function(){var j=window.URL||window.webkitURL;var b=window.Blob;if(!j||!b){throw new Error("This browser does not support AudioSynth")}var e=false;var d=null;var k=function(n,m){return[new Uint8Array([m,m>>8]),new Uint8Array([m,m>>8,m>>16,m>>24])][n]};var i=function(r,p,m,q){Object.defineProperty(this,r,{value:p,writable:!!m,enumerable:!!q})};var l=function(q,p,m){i.call(this,q,p,m,true)};a=function a(){this.__init__.apply(this,arguments)};var c=i.bind(a.prototype);var h=l.bind(a.prototype);c("__init__",function(n,m,p){if(!e){throw new Error("AudioSynthInstrument can only be instantiated from the createInstrument method of the AudioSynth object.")}i.call(this,"_parent",n);l.call(this,"name",m);i.call(this,"_soundID",p)});h("play",function(n,m,p){return this._parent.play(this._soundID,n,m,p)});h("generate",function(n,m,p){return this._parent.generate(this._soundID,n,m,p)});g=function g(){if(d instanceof g){return d}else{this.__init__();return this}};c=i.bind(g.prototype);h=l.bind(g.prototype);c("_debug",false,true);c("_bitsPerSample",16);c("_channels",1);c("_sampleRate",44100,true);h("setSampleRate",function(m){this._sampleRate=Math.max(Math.min(m|0,44100),4000);this._clearCache();return this._sampleRate});h("getSampleRate",function(){return this._sampleRate});c("_volume",32768,true);h("setVolume",function(m){m=parseFloat(m);if(isNaN(m)){m=0}m=Math.round(m*32768);this._volume=Math.max(Math.min(m|0,32768),0);this._clearCache();return this._volume});h("getVolume",function(){return Math.round(this._volume/32768*10000)/10000});c("_notes",{C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:346.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88});c("_fileCache",[],true);c("_temp",{},true);c("_sounds",[],true);c("_mod",[function(n,p,q,m){return Math.sin((2*Math.PI)*(n/p)*q+m)}]);c("_resizeCache",function(){var r=this._fileCache;var n=this._sounds.length;while(r.length<n){var m=[];for(var q=0;q<8;q++){var s={};for(var p in this._notes){s[p]={}}m.push(s)}r.push(m)}});c("_clearCache",function(){this._fileCache=[];this._resizeCache()});h("generate",function(B,q,E,n){var J=this._sounds[B];if(!J){for(var H=0;H<this._sounds.length;H++){if(this._sounds[H].name==B){J=this._sounds[H];B=H;break}}}if(!J){throw new Error("Invalid sound or sound ID: "+B)}var A=(new Date).valueOf();this._temp={};E|=0;E=Math.min(8,Math.max(1,E));var x=!n?2:parseFloat(n);if(typeof(this._notes[q])=="undefined"){throw new Error(q+" is not a valid note.")}if(typeof(this._fileCache[B][E-1][q][x])!="undefined"){if(this._debug){console.log((new Date).valueOf()-A,"ms to retrieve (cached)")}return this._fileCache[B][E-1][q][x]}else{var D=this._notes[q]*Math.pow(2,E-4);var r=this._sampleRate;var G=this._volume;var m=this._channels;var y=this._bitsPerSample;var I=J.attack(r,D,G);var v=J.dampen(r,D,G);var z=J.wave;var s={modulate:this._mod,vars:this._temp};var M=0;var w=0;var L=new Uint8Array(new ArrayBuffer(Math.ceil(r*x*2)));var C=(r*I)|0;var K=(r*x)|0;for(var H=0|0;H!==C;H++){M=G*(H/(r*I))*z.call(s,H,r,D,G);L[H<<1]=M;L[(H<<1)+1]=M>>8}for(;H!==K;H++){M=G*Math.pow((1-((H-(r*I))/(r*(x-I)))),v)*z.call(s,H,r,D,G);L[H<<1]=M;L[(H<<1)+1]=M>>8}var F=["RIFF",k(1,4+(8+24)+(8+8)),"WAVE","fmt ",k(1,16),k(0,1),k(0,m),k(1,r),k(1,r*m*y/8),k(0,m*y/8),k(0,y),"data",k(1,L.length*m*y/8),L];var p=new b(F,{type:"audio/wav"});var u=j.createObjectURL(p);this._fileCache[B][E-1][q][x]=u;if(this._debug){console.log((new Date).valueOf()-A,"ms to generate")}return u}});h("play",function(r,n,m,q){var s=this.generate(r,n,m,q);var p=new Audio(s);p.play();return true});h("debug",function(){this._debug=true});h("createInstrument",function(r){var s=0;var q=false;if(typeof(r)=="string"){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].name==r){q=true;s=p;break}}}else{if(this._sounds[r]){s=r;r=this._sounds[s].name;q=true}}if(!q){throw new Error("Invalid sound or sound ID: "+r)}e=true;var m=new a(this,r,s);e=false;return m});h("listSounds",function(){var n=[];for(var m=0;m<this._sounds.length;m++){n.push(this._sounds[m].name)}return n});c("__init__",function(){this._resizeCache()});h("loadSoundProfile",function(){for(var n=0,m=arguments.length;n<m;n++){o=arguments[n];if(!(o instanceof Object)){throw new Error("Invalid sound profile.")}this._sounds.push(o)}this._resizeCache();return true});h("loadModulationFunction",function(){for(var n=0,m=arguments.length;n<m;n++){f=arguments[n];if(typeof(f)!="function"){throw new Error("Invalid modulation function.")}this._mod.push(f)}return true});d=new g();Synth=d}();Synth.loadModulationFunction(function(c,b,d,a){return 1*Math.sin(2*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 1*Math.sin(4*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 1*Math.sin(8*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 1*Math.sin(0.5*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 1*Math.sin(0.25*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 0.5*Math.sin(2*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 0.5*Math.sin(4*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 0.5*Math.sin(8*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 0.5*Math.sin(0.5*Math.PI*((c/b)*d)+a)},function(c,b,d,a){return 0.5*Math.sin(0.25*Math.PI*((c/b)*d)+a)});Synth.loadSoundProfile({name:"piano",attack:function(){return 0.002},dampen:function(a,c,b){return Math.pow(0.5*Math.log((c*b)/a),2)},wave:function(b,a,e,c){var d=this.modulate[0];return this.modulate[1](b,a,e,Math.pow(d(b,a,e,0),2)+(0.75*d(b,a,e,0.25))+(0.1*d(b,a,e,0.5)))}},{name:"organ",attack:function(){return 0.3},dampen:function(a,b){return 1+(b*0.01)},wave:function(b,a,d){var c=this.modulate[0];return this.modulate[1](b,a,d,c(b,a,d,0)+0.5*c(b,a,d,0.25)+0.25*c(b,a,d,0.5))}},{name:"acoustic",attack:function(){return 0.002},dampen:function(){return 1},wave:function(d,k,j){var g=this.vars;g.valueTable=!g.valueTable?[]:g.valueTable;if(typeof(g.playVal)=="undefined"){g.playVal=0}if(typeof(g.periodCount)=="undefined"){g.periodCount=0}var b=g.valueTable;var a=g.playVal;var l=g.periodCount;var h=k/j;var e=Math.floor((h-Math.floor(h))*100);var m=false;if(b.length<=Math.ceil(h)){b.push(Math.round(Math.random())*2-1);return b[b.length-1]}else{b[a]=(b[a>=(b.length-1)?0:a+1]+b[a])*0.5;if(a>=Math.floor(h)){if(a<Math.ceil(h)){if((l%100)>=e){m=true;b[a+1]=(b[0]+b[a+1])*0.5;g.periodCount++}}else{m=true}}var c=b[a];if(m){g.playVal=0}else{g.playVal++}return c}}},{name:"edm",attack:function(){return 0.002},dampen:function(){return 1},wave:function(c,a,e){var d=this.modulate[0];var b=this.modulate.slice(1);return b[0](c,a,e,b[9](c,a,e,b[2](c,a,e,Math.pow(d(c,a,e,0),3)+Math.pow(d(c,a,e,0.5),5)+Math.pow(d(c,a,e,1),7)))+b[8](c,a,e,d(c,a,e,1.75)))}});